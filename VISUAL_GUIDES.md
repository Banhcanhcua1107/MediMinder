# ğŸ¨ MEDICATION REMINDER SYSTEM - VISUAL GUIDES

## ğŸ—ï¸ SYSTEM ARCHITECTURE

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                        MEDICATION REMINDER SYSTEM                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           USER INTERFACE LAYER                          â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚   add_med_screen     â”‚  â”‚ medicine_list_screen â”‚                   â”‚
â”‚  â”‚  (Add/Edit Medicine) â”‚  â”‚  (View Medicines)    â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BUSINESS LOGIC LAYER (Providers)                    â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  MedicineProvider / MedicineRepository                           â”‚  â”‚
â”‚  â”‚  â”œâ”€ Add/Update/Delete medicine                                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ Get today's medicines                                         â”‚  â”‚
â”‚  â”‚  â””â”€ Record intakes                                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NOTIFICATION SERVICE    â”‚  â”‚ BACKGROUND TASK SERVICE        â”‚
â”‚  notification_service    â”‚  â”‚ background_task_service.dart   â”‚
â”‚  .dart                   â”‚  â”‚                                â”‚
â”‚                          â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”‚ Workmanager Task        â”‚   â”‚
â”‚ â”‚Initialize()          â”‚ â”‚  â”‚ â”‚ (Every 4 hours)        â”‚   â”‚
â”‚ â”œâ”€ Timezone setup      â”‚ â”‚  â”‚ â”œâ”€ Load medicines        â”‚   â”‚
â”‚ â”œâ”€ Channel creation    â”‚ â”‚  â”‚ â”œâ”€ Schedule notifs       â”‚   â”‚
â”‚ â””â”€ Permissions         â”‚ â”‚  â”‚ â””â”€ Sync data            â”‚   â”‚
â”‚                        â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                                 â”‚
â”‚ â”‚Schedule Methods      â”‚ â”‚                                 â”‚
â”‚ â”œâ”€ scheduleDailyNot() â”‚ â”‚                                 â”‚
â”‚ â”œâ”€ showImmediateNot() â”‚ â”‚                                 â”‚
â”‚ â””â”€ scheduleOneTimeNot()â”‚ â”‚                                 â”‚
â”‚                        â”‚ â”‚                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                                 â”‚
â”‚ â”‚Management            â”‚ â”‚                                 â”‚
â”‚ â”œâ”€ cancelNotification()â”‚ â”‚                                 â”‚
â”‚ â”œâ”€ logPending()        â”‚ â”‚                                 â”‚
â”‚ â””â”€ generateID()        â”‚ â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                                 â”‚
             â”‚             â”‚                                 â”‚
             â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
        â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚       ANDROID NATIVE LAYER (Platform Channels)       â”‚â”‚
â”‚                                                      â”‚â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚â”‚
â”‚  â”‚ AlarmManager (flutter_local_notifications)  â”‚   â”‚â”‚
â”‚  â”‚ â”œâ”€ setExactAndAllowWhileIdle()              â”‚   â”‚â”‚
â”‚  â”‚ â”œâ”€ matchDateTimeComponents (daily)          â”‚   â”‚â”‚
â”‚  â”‚ â””â”€ Bypass Doze mode                         â”‚   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚â”‚
â”‚                                                      â”‚â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚â”‚
â”‚  â”‚ NotificationManager                          â”‚   â”‚â”‚
â”‚  â”‚ â”œâ”€ Create AndroidNotificationChannel         â”‚   â”‚â”‚
â”‚  â”‚ â”œâ”€ Show notification with actions            â”‚   â”‚â”‚
â”‚  â”‚ â””â”€ Handle pending intents                    â”‚   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š DATA FLOW DIAGRAM

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       USER ACTION FLOW                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. ADD MEDICINE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  User Input (UI)
        â”‚
        â–¼
  Validation
        â”‚
        â”œâ”€ Name not empty?
        â”œâ”€ Time selected?
        â””â”€ Quantity > 0?
        â”‚
        â–¼
  Save to Supabase
        â”‚
        â”œâ”€ user_medicines table
        â”œâ”€ medicine_schedules table
        â””â”€ medicine_schedule_times table
        â”‚
        â–¼
  Schedule Notifications
        â”‚
        â”œâ”€ For each schedule time:
        â”‚  â””â”€ generate unique ID
        â”‚  â””â”€ calculate trigger time (time - 1 min)
        â”‚  â””â”€ call scheduleDailyNotification()
        â”‚
        â””â”€ AlarmManager queues reminder
        
  Show Success Confirmation
        â”‚
        â””â”€ Immediate notification popup


2. SCHEDULED TRIGGER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Time = HH:MM (+ 1 day from now)
        â”‚ (Android System)
        â”‚
        â–¼
  AlarmManager.exactAllowWhileIdle() triggers
        â”‚
        â–¼
  NotificationManager.notify()
        â”‚
        â”œâ”€ Build notification content
        â”œâ”€ Add actions (Taken/Snooze)
        â”œâ”€ Set alarm audio attributes
        â””â”€ Display on lock screen
        â”‚
        â–¼
  User sees notification
        â”‚
        â”œâ”€ Full screen on lock screen
        â”œâ”€ "ğŸ’Š Äáº¿n giá» uá»‘ng thuá»‘c!"
        â”œâ”€ Medicine name & dosage
        â””â”€ Actions: [ÄÃ£ uá»‘ng] [HoÃ£n 10p]


3. USER ACTION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  User taps action
        â”‚
        â”œâ”€ "ÄÃ£ uá»‘ng" â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                               â”‚
        â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                    â”‚ Handle TAKEN_ACTION  â”‚
        â”‚                    â”‚                      â”‚
        â”‚                    â”œâ”€ Get user from auth â”‚
        â”‚                    â”œâ”€ Get medicine data  â”‚
        â”‚                    â”œâ”€ Create record:     â”‚
        â”‚                    â”‚  - medicine_intakes â”‚
        â”‚                    â”‚  - status: taken    â”‚
        â”‚                    â”‚  - taken_at: now    â”‚
        â”‚                    â”‚                      â”‚
        â”‚                    â”œâ”€ Cancel notificationâ”‚
        â”‚                    â””â”€ Show confirmation  â”‚
        â”‚
        â”œâ”€ "HoÃ£n 10p" â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                               â”‚
        â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                    â”‚ Handle SNOOZE_ACTION â”‚
        â”‚                    â”‚                       â”‚
        â”‚                    â”œâ”€ Get current time    â”‚
        â”‚                    â”œâ”€ Add 10 minutes      â”‚
        â”‚                    â”œâ”€ Schedule new notif  â”‚
        â”‚                    â”‚  - with offset ID    â”‚
        â”‚                    â”‚  - same payload      â”‚
        â”‚                    â””â”€ Show snooze confirm â”‚
        â”‚
        â”‚ (Database recorded)
        â”‚
        â–¼
  Next day same time
        â”‚
        â””â”€ Notification repeats
           (daily repetition)


4. BACKGROUND REFRESH (Every 4 hours)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Workmanager triggers
        â”‚
        â–¼
  _handleMedicineCheckTask()
        â”‚
        â”œâ”€ Load medicines from cache
        â”œâ”€ Or fetch from Supabase
        â”‚
        â”œâ”€ For each medicine:
        â”‚  â””â”€ For each schedule time:
        â”‚     â””â”€ Schedule daily notification
        â”‚
        â””â”€ Refresh complete
```

---

## â° TIMING DIAGRAM

```
USER SCHEDULE TIME:    08:00 AM
                       â”‚
                       â”‚ Set initially at 07:59 AM
                       â”‚ (1 minute before)
                       â”‚
TRIGGER TIME:    â”€â”€â”€â”€â–º 07:59:00 AM â—„â”€â”€â”€â”€ AlarmManager fires
                       â”‚
                       â”‚ Notification shows
DISPLAY TIME:    â”€â”€â”€â”€â–º 07:59:02 AM        (within 2 seconds)
                       â”‚
                       â”‚ User responds
USER ACTION TIME:      07:59:30 AM        (30 sec later)
                       â”‚ Database record created
                       â”‚
MEDICINE TIME:   â”€â”€â”€â”€â–º 08:00:00 AM        (1 min after trigger)
                       â”‚
                       â”‚ User takes medicine
ACTUAL TAKE TIME:      08:03:00 AM        (recorded in DB)
                       â”‚
                       â”‚ Next day
REPEAT:          â”€â”€â”€â”€â–º 07:59:00 AM + 1 day (Next day same time)


DAILY CYCLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Day 1:
  07:59 AM â”€â”€ Notification appears â”€â”€ 08:00 AM
    â–²                                    â”‚
    â”‚ Action: "Taken"                    â”‚ Actual medicine taken
    â”‚ Recorded to DB â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Day 2:
  (next 24 hours)
  07:59 AM â”€â”€ Notification appears â”€â”€ 08:00 AM
    â–²                                    â”‚
    â”‚ Action: "Taken"                    â”‚ Actual medicine taken
    â”‚ Recorded to DB â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Day N:
  (continues indefinitely)
  07:59 AM â”€â”€ Notification appears â”€â”€ ...
```

---

## ğŸ¯ STATE DIAGRAM

```
NOTIFICATION STATES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  PENDING     â”‚  (Scheduled, waiting for time)
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    (Time triggers)
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  DISPLAYED       â”‚  (Showing on device)
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
                         â”‚         â”‚
                    (User taps)    (User dismisses)
                         â”‚         â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                                   â”‚
            â–¼                                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  TAKEN       â”‚                    â”‚  SKIPPED     â”‚
    â”‚ - Database   â”‚                    â”‚ - Dismissed  â”‚
    â”‚   record     â”‚                    â”‚ - Not taken  â”‚
    â”‚ - Removed    â”‚                    â”‚ - Pendingâ†’   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚   Skipped    â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


ACTION FLOW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        NOTIFICATION
              â”‚
              â”œâ”€ Tap "ÄÃ£ uá»‘ng"
              â”‚  â””â”€ TAKEN_ACTION
              â”‚     â””â”€ Record: status=taken, taken_at=now
              â”‚     â””â”€ Database: insert medicine_intakes
              â”‚     â””â”€ UI: Show âœ… confirmation
              â”‚
              â”œâ”€ Tap "HoÃ£n 10p"
              â”‚  â””â”€ SNOOZE_ACTION
              â”‚     â””â”€ Schedule: +10 minutes
              â”‚     â””â”€ ID: original + 10000
              â”‚     â””â”€ UI: Show â±ï¸ confirmation
              â”‚
              â””â”€ Dismiss (no action)
                 â””â”€ Record: status=skipped
                 â””â”€ Notification removed
```

---

## ğŸ“ˆ CLASS HIERARCHY

```
DART CLASSES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

NotificationService
â”œâ”€ Singleton pattern
â”œâ”€ Methods:
â”‚  â”œâ”€ initialize() â†’ Setup & create channel
â”‚  â”œâ”€ requestPermissions() â†’ Ask OS for perms
â”‚  â”œâ”€ requestBatteryPermission() â†’ Bypass Doze
â”‚  â”œâ”€ scheduleDailyNotification() â†’ Main scheduling
â”‚  â”œâ”€ scheduleOneTimeNotification() â†’ One-off
â”‚  â”œâ”€ showImmediateNotification() â†’ Test/Confirmation
â”‚  â”œâ”€ cancelNotification() â†’ Remove specific
â”‚  â”œâ”€ cancelAllNotifications() â†’ Remove all
â”‚  â”œâ”€ logPendingNotifications() â†’ Debug
â”‚  â””â”€ generateNotificationId() â†’ Unique ID
â”‚
â””â”€ Properties:
   â”œâ”€ _flutterLocalNotificationsPlugin
   â”œâ”€ _isInitialized
   â””â”€ _getAlarmNotificationDetails()


MedicineIntake (Data Model)
â”œâ”€ Properties:
â”‚  â”œâ”€ id, userId, userMedicineId
â”‚  â”œâ”€ medicineName, dosageStrength
â”‚  â”œâ”€ quantityPerDose
â”‚  â”œâ”€ scheduledDate, scheduledTime
â”‚  â”œâ”€ takenAt
â”‚  â”œâ”€ status (pending/taken/skipped)
â”‚  â”œâ”€ createdAt, updatedAt
â”‚
â”œâ”€ Methods:
â”‚  â”œâ”€ toJson() â†’ Serialize
â”‚  â”œâ”€ fromJson() â†’ Deserialize
â”‚  â””â”€ copyWith() â†’ Clone with changes
â”‚
â””â”€ Used for database tracking


BackgroundTaskService
â”œâ”€ Periodic task scheduler
â”œâ”€ Methods:
â”‚  â”œâ”€ initialize() â†’ Setup Workmanager
â”‚  â”œâ”€ scheduleMedicineCheckTask() â†’ Every 4h
â”‚  â”œâ”€ scheduleMedicineSyncTask() â†’ Every 6h
â”‚  â””â”€ cancelAllTasks() â†’ Stop all
â”‚
â””â”€ Runs _handleMedicineCheckTask() periodically
   â””â”€ Refreshes notification schedule
```

---

## ğŸ”— DEPENDENCY GRAPH

```
main.dart
â”œâ”€ NotificationService â”€â”€â”
â”‚                        â”‚
â”œâ”€ BackgroundTaskServiceâ”€â”¤â”€â”€â”
â”‚                        â”‚  â”‚
â”œâ”€ MedicineProvider      â”‚  â”‚
â”‚  â””â”€ MedicineRepository â”‚  â”‚
â”‚     â””â”€ Supabase        â”‚  â”‚
â”‚                        â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¼â”€ Supabase
                         â”‚  â”‚
add_med_screen.dart â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€ MedicineProvider         â”‚
â”œâ”€ NotificationService      â”‚
â””â”€ MedicineRepository       â”‚
   â””â”€ Supabase â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


TABLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

user_medicines (existing)
â”œâ”€ id, user_id
â”œâ”€ name, dosage_strength
â”œâ”€ quantity_per_dose
â”œâ”€ is_active
â””â”€ schedule info

medicine_schedules (existing)
â”œâ”€ id, user_medicine_id
â””â”€ schedule config

medicine_schedule_times (existing)
â”œâ”€ id, schedule_id
â”œâ”€ time_of_day
â””â”€ order_index

medicine_intakes (NEW!)
â”œâ”€ id, user_id
â”œâ”€ user_medicine_id
â”œâ”€ medicine_name
â”œâ”€ scheduled_date
â”œâ”€ scheduled_time
â”œâ”€ taken_at
â””â”€ status
```

---

## ğŸ§ª TEST FLOW DIAGRAM

```
TEST LEVELS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

UNIT TESTS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ generateNotificationId()               â”‚
â”‚ â€¢ Timezone conversion                    â”‚
â”‚ â€¢ Time calculation (trigger = time - 1) â”‚
â”‚ â€¢ Database models serialization          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
INTEGRATION TESTS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ scheduleDailyNotification() + verify   â”‚
â”‚ â€¢ Database insert + read                 â”‚
â”‚ â€¢ Supabase sync                          â”‚
â”‚ â€¢ Background task execution              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
SYSTEM TESTS (Real Device)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ Notification appears on time           â”‚
â”‚ â€¢ Lock screen display                    â”‚
â”‚ â€¢ User action handling                   â”‚
â”‚ â€¢ Doze mode behavior                     â”‚
â”‚ â€¢ Daily repetition (24h test)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
USER ACCEPTANCE TEST
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ Add medicine â†’ Get notification        â”‚
â”‚ â€¢ Mark taken â†’ Database record           â”‚
â”‚ â€¢ Snooze â†’ Notif 10 min later           â”‚
â”‚ â€¢ Next day â†’ Notif repeats              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š SEQUENCE DIAGRAM

```
ADD MEDICINE SEQUENCE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

User              UI                Provider           Database
 â”‚                 â”‚                   â”‚                  â”‚
 â”œâ”€ Add medicineâ”€â”€â–¶â”‚                   â”‚                  â”‚
 â”‚                 â”œâ”€ Validate        â”‚                  â”‚
 â”‚                 â”œâ”€ Create modelâ”€â”€â”€â”€â–¶â”‚                  â”‚
 â”‚                 â”‚                   â”œâ”€ Save dataâ”€â”€â”€â”€â”€â”€â–¶â”‚
 â”‚                 â”‚                   â”‚â—€â”€ Return IDâ”€â”€â”€â”€â”€â”€â”¤
 â”‚                 â”‚â—€â”€â”€â”€â”€ New ID â”€â”€â”€â”€â”€â”€â”¤                  â”‚
 â”‚                 â”œâ”€ Schedule notif  â”‚                  â”‚
 â”‚                 â”‚  For each time:  â”‚                  â”‚
 â”‚                 â”‚    â”œâ”€ Gen ID     â”‚                  â”‚
 â”‚                 â”‚    â”œâ”€ Calc time  â”‚                  â”‚
 â”‚                 â”‚    â””â”€ Schedule   â”‚                  â”‚
 â”‚                 â”‚                   â”‚                  â”‚
 â”‚                 â”œâ”€ Show confirm â—€â”€â”€â”¤                  â”‚
 â”‚                 â”‚                   â”‚                  â”‚
 â”‚â—€â”€ Success msgâ”€â”€â”¤                   â”‚                  â”‚
 â”‚                 â”‚                   â”‚                  â”‚


NOTIFICATION TRIGGER SEQUENCE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

System         AlarmManager        NotificationMgr      Device
 â”‚                â”‚                    â”‚                 â”‚
 â”œâ”€ Time checkâ”€â”€â”€â–¶â”‚                    â”‚                 â”‚
 â”‚                â”œâ”€ exactAllowWhileâ”€â”€â”€â–¶â”‚                 â”‚
 â”‚                â”‚                    â”œâ”€ Build notifâ”€â”€â”€â–¶â”‚
 â”‚                â”‚                    â”‚                 â”œâ”€ Lock screen
 â”‚                â”‚                    â”‚                 â”œâ”€ Notification panel
 â”‚                â”‚                    â”‚                 â”œâ”€ Sound
 â”‚                â”‚                    â”‚                 â””â”€ Vibration
 â”‚                â”‚                    â”‚                 â”‚
 â”‚                â”‚                    â”‚â—€â”€ User tappedâ”€â”€â”€â”¤
 â”‚                â”‚                    â”‚ "ÄÃ£ uá»‘ng"      â”‚
 â”‚                â”‚                    â”‚                 â”‚
 â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Action handler  â”‚
 â”‚   â”‚            Isolate callback
 â”‚   â”‚            @pragma('vm:entry-point')
 â”‚
 â””â”€â”€â–¶ Database record created
      Notification cancelled
```

---

## ğŸ¯ USE CASE DIAGRAM

```
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚      USER           â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                â”‚                â”‚
                    â–¼                â–¼                â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Add Med    â”‚  â”‚  View Historyâ”‚  â”‚ View Stats â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                â”‚                â”‚
                    â–¼                â”‚                â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚                â”‚
            â”‚   System    â”‚          â”‚                â”‚
            â”‚ Receives    â”‚          â”‚                â”‚
            â”‚Reminder     â”‚          â”‚                â”‚
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â”‚                â”‚
                   â”‚                 â”‚                â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”            â”‚                â”‚
            â–¼           â–¼            â”‚                â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚                â”‚
    â”‚ Mark Taken  â”‚ â”‚  Snooze  â”‚    â”‚                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                â”‚
            â”‚           â”‚            â”‚                â”‚
            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜            â”‚                â”‚
                  â–¼                  â–¼                â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  Update        â”‚  â”‚  Retrieve Data â”‚  â”‚ Report â”‚
          â”‚  Database      â”‚  â”‚  from Database â”‚  â”‚ Stats  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

End of Visual Guides
